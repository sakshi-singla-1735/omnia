# Copyright 2025 Dell Inc. or its subsidiaries. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---

# ***********************************************************************
# DO NOT REMOVE OR COMMENT OUT ANY LINES IN THIS FILE.
# SIMPLY APPEND THE REQUIRED VALUES AGAINST THE PARAMETER OF YOUR CHOICE.
# ***********************************************************************

# ============================================================================
# TELEMETRY CONFIGURATION OVERVIEW
# ============================================================================
# This file configures telemetry data collection and storage for Dell Omnia.
#
# SECTIONS:
#   1. iDRAC Telemetry    : Hardware metrics from Dell PowerEdge servers
#   2. VictoriaMetrics    : Time-series database for metric storage
#   3. Kafka              : Distributed streaming platform for telemetry data
#   4. LDMS               : Lightweight Distributed Metric Service for compute nodes
#
# STORAGE OPTIONS:
#   - VictoriaMetrics: Store iDRAC telemetry in time-series database
#   - Kafka: Stream iDRAC and LDMS telemetry to Kafka topics
#   - Both: Store iDRAC in both Victoria and Kafka (recommended)
# ============================================================================

# ============================================================================
# iDRAC TELEMETRY CONFIGURATION
# ============================================================================
# iDRAC telemetry collects hardware metrics from Dell PowerEdge servers.
# Telemetry data can be stored in VictoriaMetrics, Kafka, or both.

# Enable or disable iDRAC telemetry support
# Accepted values: true or false
# Default: true
idrac_telemetry_support: true

# Specify where to store iDRAC telemetry data
# Supported values:
#   - "victoria"        : Store in VictoriaMetrics only
#   - "kafka"           : Store in Kafka only
#   - "victoria,kafka"  : Store in both (recommended)
# Default: "victoria,kafka"
idrac_telemetry_collection_type: "victoria,kafka"

# ============================================================================
# VICTORIAMETRICS CONFIGURATION
# ============================================================================
# VictoriaMetrics is a time-series database for storing telemetry metrics.
# Used for iDRAC telemetry when 'victoria' is enabled in idrac_telemetry_collection_type.
victoria_configurations:
  # The amount of storage allocated for victoria's persistent volume.
  # Accepted values: in the form of "X[Ki|Mi|Gi|Ti|Pi|Ei]"
  # Default: 8Gi
  persistence_size: "8Gi"

  # Duration (in hours) to retain victoria logs before they are deleted.
  # Default: 168 (7 days)
  retention_period: 168

# ============================================================================
# KAFKA CONFIGURATION
# ============================================================================
# Apache Kafka is a distributed streaming platform for storing telemetry data.
# Used for iDRAC telemetry when 'kafka' is enabled in idrac_telemetry_collection_type.
# Also used for LDMS telemetry when LDMS software is configured.
#
# NOTE: Kafka topics are auto-generated based on enabled features:
#   - 'idrac' topic: Required when idrac_telemetry_support=true and 'kafka' is enabled
#   - 'ldms' topic:  Required when LDMS is configured in software_config.json
#   - 'ome' topic:   Optional for OpenManage Enterprise telemetry
kafka_configurations:
  # The amount of storage allocated for Kafka's persistent volume.
  # This storage will be divided among 6 pods, comprising 3 Kafka brokers and 3 Kafka controllers.
  # Accepted values: in the form of "X[Ki|Mi|Gi|Ti|Pi|Ei]"
  # Default: 48Gi
  persistence_size: "48Gi"

  # The number of hours to retain Kafka logs before they are deleted.
  # Default: 168 (7 days)
  log_retention_hours: 168

  # The maximum size of Kafka logs (in bytes) before they are deleted.
  # Default: -1 (unlimited)
  log_retention_bytes: -1

  # The maximum size of Kafka log segments (in bytes) before they are deleted.
  # Default: 1073741824 (1 GB)
  log_segment_bytes: 1073741824

  # Kafka Topic Partitions Configuration
  # ----------------------------------------------------------------------------
  # Define the number of partitions for each Kafka topic.
  # Increasing partitions can improve throughput but also increases storage/overhead.
  #
  # IMPORTANT: Topic names are FIXED and cannot be changed.
  #   - Topic names: Only 'idrac', 'ldms', and 'ome' are allowed
  #   - Configurable: Only partition counts can be modified
  #
  # Topic Requirements (auto-validated):
  #   - 'idrac': Required when idrac_telemetry_support=true and 'kafka' is enabled
  #   - 'ldms':  Required when LDMS software is configured in software_config.json
  #   - 'ome':   Optional (OpenManage Enterprise telemetry)
  #
  # Default partition counts: idrac=1, ldms=2, ome=1
  topic_partitions:
    - name: "idrac"
      partitions: 1
    - name: "ldms"
      partitions: 2
    - name: "ome"
      partitions: 1

# ============================================================================
# LDMS (Lightweight Distributed Metric Service) CONFIGURATION
# ============================================================================
# LDMS collects performance metrics from compute nodes (CPU, memory, network, etc.)
# and streams them to Kafka for storage and analysis.
#
# PREREQUISITE: To enable LDMS support, add the following to software_config.json:
#   {
#     "softwares": [
#       {"name": "ldms", "arch": ["x86_64", "aarch64"]}
#     ]
#   }
#
# When LDMS software is configured, the 'ldms' topic MUST be defined in
# kafka_configurations.topic_partitions above.
#
# LDMS Port Configurations
# Aggregator port on service k8s cluster
# Valid range: 6001-6100
# Default: 6001
ldms_agg_port: 6001

# Store daemon port on service k8s cluster
# Can be the same as ldms_agg_port
# Valid range: 6001-6100
# Default: 6001
ldms_store_port: 6001

# Sampler port on compute nodes
# Valid range: 10001-10100
# Default: 10001
ldms_sampler_port: 10001

# LDMS Sampler Plugin Configurations
# ----------------------------------------------------------------------------
# Configure which metrics to collect from compute nodes and collection intervals.
# Each plugin collects specific system metrics.
#
# Parameters:
#   - plugin_name: Name of the LDMS sampler plugin
#   - config_parameters: Plugin-specific configuration (as a single string)
#   - activation_parameters: Collection schedule in MICROSECONDS
#       Format: "interval=<microseconds> offset=<microseconds>"
#       Example: "interval=1000000"         (1000000 microseconds = 1 second)
#                "interval=1000000 offset=0" (1000000 microseconds with no offset)
#
# Available Plugins:
#   - meminfo: Memory usage statistics
#   - procstat2: Process statistics
#   - vmstat: Virtual memory statistics
#   - loadavg: System load average
#   - slurm_sampler: Slurm job/task monitoring (HPC workloads)
#   - procnetdev2: Network interface statistics
ldms_sampler_configurations:
  # Memory usage statistics (free, used, buffers, cached, etc.)
  - plugin_name: meminfo
    config_parameters: ""
    activation_parameters: "interval=1000000"  # interval=1000000 microseconds

  # Process statistics (CPU, memory, I/O per process)
  - plugin_name: procstat2
    config_parameters: ""
    activation_parameters: "interval=1000000"  # interval=1000000 microseconds

  # Virtual memory statistics (paging, swapping, memory pressure)
  - plugin_name: vmstat
    config_parameters: ""
    activation_parameters: "interval=1000000"  # interval=1000000 microseconds

  # System load average (1, 5, and 15 minute averages)
  - plugin_name: loadavg
    config_parameters: ""
    activation_parameters: "interval=1000000"  # interval=1000000 microseconds

  # Slurm job and task monitoring (HPC workload telemetry)
  # Config parameters:
  #   - component_id=2: Component identifier (default: 0)
  #   - stream=slurm: Data stream type
  #   - job_count=8: Number of jobs to monitor (default: 8)
  #   - task_count=8: Number of tasks to monitor per job (default: 8)
  - plugin_name: slurm_sampler
    config_parameters: "component_id=2 stream=slurm job_count=8 task_count=8"
    activation_parameters: "interval=1000000 offset=0"  # interval=1000000 microseconds, offset=0

  # Network interface statistics (bytes, packets, errors, drops per interface)
  # Config parameters (optional):
  #   - ifaces=eth0,eth1: Specific interfaces to monitor
  #   - If not specified, all network interfaces will be monitored
  - plugin_name: procnetdev2
    config_parameters: ""  # Monitor all interfaces
    activation_parameters: "interval=1000000 offset=0"  # interval=1000000 microseconds, offset=0
