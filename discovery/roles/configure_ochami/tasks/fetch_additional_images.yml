# Copyright 2026 Dell Inc. or its subsidiaries. All Rights Reserved.
#
#  Licensed under the Apache License, Version 2.0 (the "License");
#  you may not use this file except in compliance with the License.
#  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.
---

- name: Load software_config.json
  ansible.builtin.include_vars:
    file: "{{ software_config_file_path }}"
    name: software_config
  delegate_to: localhost
  run_once: true

- name: Set dynamic additional_json_path
  ansible.builtin.set_fact:
    additional_json_path: "{{ input_project_dir }}/config/x86_64/{{ software_config.cluster_os_type }}/{{ software_config.cluster_os_version }}/additional_packages.json" # noqa: yaml[line-length]
  delegate_to: localhost
  run_once: true

- name: Collect additional container images from additional_packages.json
  additional_images_collector:
    additional_json_path: "{{ additional_json_path }}"
    software_config_path: "{{ software_config_file_path }}"
  delegate_to: localhost
  run_once: true
  register: additional_images_output

- name: Set additional_images_dict fact
  ansible.builtin.set_fact:
    additional_images_dict: "{{ additional_images_output.additional_images_dict }}"

- name: Debug additional_images_dict
  ansible.builtin.debug:
    var: additional_images_dict
    verbosity: 2
