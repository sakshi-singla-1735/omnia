resources:
  - telemetry_secret_creation.yaml
{% set types = hostvars['localhost']['idrac_telemetry_collection_type'].split(',') %}
{% if 'victoria' in types %}
  # VictoriaMetrics Common Resources
  - victoria-tls-secret.yaml
  - victoria-vmagent-rbac.yaml
  - vmagent-scrape-config.yaml
  - victoria-agent-deployment.yaml
  # VictoriaMetrics Deployment (mode: {{ hostvars['localhost']['victoria_configurations']['deployment_mode'] }})
{% if hostvars['localhost']['victoria_configurations']['deployment_mode'] == 'cluster' %}
  # Cluster Mode: High-availability deployment
  - victoria-cluster-vmstorage.yaml
  - victoria-cluster-vminsert.yaml
  - victoria-cluster-vmselect.yaml
{% else %}
  # Single-Node Mode: Simple deployment
  - victoria-statefulset.yaml
{% endif %}
  # Uncomment to deploy VictoriaMetrics TLS test job
  # - test/victoria-tls-test-job.yaml
{% endif %}
{% if kafka_support %}
  - kafka.kafka.yaml
  - kafka.kafkapump_user.yaml
{% if hostvars['localhost']['idrac_telemetry_support'] and 'kafka' in hostvars['localhost']['idrac_telemetry_collection_type'].split(',') %}
  - kafka.topic_idrac.yaml
{% endif %}
{% if hostvars['localhost']['ldms_support'] %}
  - kafka.topic_ldms.yaml
{% endif %}
  - kafka.kafka_bridge.yaml
  - kafka.kafka_bridge_lb.yaml
  # Uncomment to deploy TLS test job
  # - test/kafka.tls_test_job.yaml
{% endif %}
{% if hostvars['localhost']['idrac_telemetry_support'] %}
  - idrac_telemetry_statefulset.yaml
  - telemetry_cleaner_rbac.yaml
  - telemetry_pod_cleanup.yaml
{% endif %}